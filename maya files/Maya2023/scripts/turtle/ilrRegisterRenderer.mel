// ===========================================================================
// Copyright 2022 Autodesk, Inc. All rights reserved.
//
// Use of this software is subject to the terms of the Autodesk license
// agreement provided at the time of installation or download, or which
// otherwise accompanies this software in either electronic or hard copy form.
// ===========================================================================
//
// provided at the time of installation or download, or which otherwise accompanies 

global proc ilrRenderLogoCallback()
{
	waitCursor -state on;
	showHelp -absolute "http://www.autodesk.com";
	waitCursor -state off;
}

global proc ilrRenderingEditorsSubMenu(string $parentMenuItem)
{
	popupMenu -e -deleteAllItems $parentMenuItem;
	setParent -m $parentMenuItem;

	menuItem -ecr false -l (uiRes("m_ilrRegisterRenderer.kBackLayerEditor"))
		-annotation "Turtle's Bake Layer Editor"
		-c "eval ilrBakeLayerEditor";

    menuItem -ecr false -l (uiRes("m_ilrRegisterRenderer.kPointCloudBakeEditor"))
        -annotation "Turtle's Point Cloud Bake Editor"
        -c "eval ilrPointCloudBakeEditor";

    menuItem -ecr false -l (uiRes("m_ilrRegisterRenderer.kIBLLightRigEditor"))
        -annotation "Turtle's IBL Light Rig Editor"
        -c "eval ilrIBLLightRigEditor";

    menuItem -ecr false -l (uiRes("m_ilrRegisterRenderer.kTextureResamplingEditor"))
        -annotation "Turtle's Texture Resampling Editor"
        -c "eval ilrTextureResamplingEditor";
}

//
// Description: This procedure is called to unregister the TURTLE renderer.
//
global proc ilrUnRegisterRenderer()
{
	if (`renderer -exists "turtle"`)
	{
		renderer -unregisterRenderer "turtle";
		print("+++++++ Turtle for Maya unregistered successfully ++++++\n");
	}

	updateRendererUI;
}

//
// Description: This procedure is called to register the TURTLE renderer.
//
global proc ilrRegisterRenderer()
{
	if (!`renderer -exists "turtle"`)
	{
		global float $gIlrMayaVersion;

		if ($gIlrMayaVersion >= 8.0)
		{
			renderer -rendererUIName			  "TURTLE"
				-renderProcedure                  "ilrRender"
				-renderRegionProcedure            "ilrRegionRender"
				-commandRenderProcedure           "ilrBatchRender"
				-batchRenderProcedure             "ilrBatchRender"
				-cancelBatchRenderProcedure       "batchRender"
				-showBatchRenderProcedure         "batchRender -showImage true"
				-renderSequenceProcedure          "mayaRenderSequence"
				-renderOptionsProcedure           ""
				-batchRenderOptionsProcedure      ""
				-renderDiagnosticsProcedure       ""
				-showRenderLogProcedure           ""
				-showBatchRenderLogProcedure      ""
				-iprRenderProcedure               ""
				-isRunningIprProcedure            ""
				-startIprRenderProcedure          ""
				-stopIprRenderProcedure           ""
				-refreshIprRenderProcedure        ""
				-pauseIprRenderProcedure          ""
				-changeIprRegionProcedure         ""
				-iprOptionsMenuLabel              ""
				-iprOptionsSubMenuProcedure       ""
				-textureBakingProcedure           ""
				-polyPrelightProcedure            ""
				-logoImageName                    ""
				-logoCallbackProcedure            "ilrRenderLogoCallback"
				-renderingEditorsSubMenuProcedure "ilrRenderingEditorsSubMenu"
				turtle;
		}
		else if ($gIlrMayaVersion >= 7.0)
		{
			renderer -rendererUIName			  "TURTLE"
				-renderProcedure                  "ilrRender"
				-renderRegionProcedure            "ilrRegionRender"
				-commandRenderProcedure           "ilrBatchRender"
				-batchRenderProcedure             "ilrBatchRender"
				-cancelBatchRenderProcedure       "batchRender"
				-showBatchRenderProcedure         "batchRender -showImage true"
				-renderOptionsProcedure           ""
				-batchRenderOptionsProcedure      ""
				-renderDiagnosticsProcedure       ""
				-showRenderLogProcedure           ""
				-showBatchRenderLogProcedure      ""
				-iprRenderProcedure               ""
				-isRunningIprProcedure            ""
				-startIprRenderProcedure          ""
				-stopIprRenderProcedure           ""
				-refreshIprRenderProcedure        ""
				-pauseIprRenderProcedure          ""
				-changeIprRegionProcedure         ""
				-iprOptionsMenuLabel              ""
				-iprOptionsSubMenuProcedure       ""
				-textureBakingProcedure           ""
				-polyPrelightProcedure            ""
				-logoImageName                    ""
				-logoCallbackProcedure            "ilrRenderLogoCallback"
				-renderingEditorsSubMenuProcedure "ilrRenderingEditorsSubMenu"
				-hasCommonGlobalValueProcedure    "mayaSoftwareHasCommonGlobalValue"
				-getCommonGlobalValueProcedure    "mayaSoftwareGetCommonGlobalValue"
				-setCommonGlobalValueProcedure    "mayaSoftwareSetCommonGlobalValue"
				turtle;
		}
		else
		{
			error("TurtleForMaya: Unsupported Maya version: " + $gIlrMayaVersion + "\n");
		}


		renderer -edit -addGlobalsNode "TurtleRenderOptions" turtle;

		registerUpdateRendererUIProc("evalDeferred -lp ilrTakeOverRenderGlobalsWindow");

		renderer -edit -addGlobalsTab "Common" "createMayaSoftwareCommonGlobalsTab" "updateMayaSoftwareCommonGlobalsTab; ilrModifyCommonTab;" turtle;

		renderer -edit -addGlobalsTab "TURTLE" "ilrBuildTurtleTab" "ilrUpdateTurtleTab" turtle;

		print("+++++++ Turtle for Maya registered successfully ++++++\n");
	}
}
