// ===========================================================================
// Copyright 2022 Autodesk, Inc. All rights reserved.
//
// Use of this software is subject to the terms of the Autodesk license
// agreement provided at the time of installation or download, or which
// otherwise accompanies this software in either electronic or hard copy form.
// ===========================================================================
//
//
//  Creation Date:  October 1998
//
//  Description:
//      The globalStitchPreset() procedure executes a offset curve operation on 
//      a curve based on the offset option vars.
//
//  Input Arguments:
//      None.
//
//  Return Value:
//      None.
//

proc string pieceTogetherGlobalStitchCmd(
 	int $history,
	int $replaceOriginal,
	int $stitchCorners,
	int $stitchEdges,
	int $stitchSmoothness,
	int $stitchInteriors,
	float $maxSeparaion,
	float $modificationResistance,
	int $sampling)
//
//	Description :
//		Piece together a globalStitch command.
//
{
	string $cmd;
	$cmd = "globalStitch ";

	// construction history
	$cmd = $cmd + " -ch ";
	if ( $history == 1 ) $cmd = $cmd + "on";
	else  $cmd = $cmd + "off";

	$cmd = $cmd + " -rpo ";
	if ( $replaceOriginal == 1 ) $cmd = $cmd + "on";
	else  $cmd = $cmd + "off";
	
	// stitch options
	$cmd = $cmd + " -sc " + $stitchCorners;
	$cmd = $cmd + " -se " + $stitchEdges;
	$cmd = $cmd + " -ss " + $stitchSmoothness;

	if($stitchInteriors == 1) $cmd = $cmd + " -spe true";
	else  $cmd = $cmd + " -spe false";

	// max separation, modification resistance
	// and sampling
	$cmd = $cmd + " -ms " + $maxSeparaion;
	$cmd = $cmd + " -mr " + $modificationResistance;
	$cmd = $cmd + " -sam " + $sampling;

	return $cmd;
}

global proc globalStitchPreset(
 	int $history,
	int $replaceOriginal,
	int $stitchCorners,
	int $stitchEdges,
	int $stitchSmoothness,
	int $stitchInteriors,
	float $maxSeparaion,
	float $modificationResistance,
	int $sampling)
//
//	globalStitch with the preset options.
//	Use this proc when operation dragged to Shelf.
//
{
	// build the command
	string $cmd = pieceTogetherGlobalStitchCmd($history,
											   $replaceOriginal,
											   $stitchCorners,
											   $stitchEdges,
											   $stitchSmoothness,
											   $stitchInteriors,
											   $maxSeparaion,
											   $modificationResistance,
											   $sampling);

	global int $gSelectNurbsSurfacesBit;
	string $srf[] = `filterExpand -ex true -sm $gSelectNurbsSurfacesBit`;

	// placeholder for one selection item
	int $nsrf = size($srf);
	int $i;
	for($i=0; $i<$nsrf; $i++) {
		$cmd += " " + $srf[$i];
	}

	string $result[] = evalEcho($cmd);

	select -r $result;
}
