// ===========================================================================
// Copyright 2022 Autodesk, Inc. All rights reserved.
//
// Use of this software is subject to the terms of the Autodesk license
// agreement provided at the time of installation or download, or which
// otherwise accompanies this software in either electronic or hard copy form.
// ===========================================================================
//
//  Description:
//
//	Stash option vars so that we can restore the state on Cancel.
//
//	Note: If adding preferences, make sure to read
//	http://torw3/maya/TechDoc/CodingGuides/addingPreferences.html
//
global string $gOptionVarPrefs[] = {

    //----------------------------------------------------------
    // Interface preferences
    //----------------------------------------------------------
    "showHomeScreenOnStartup",
    "showHomeMenubarIcon",
    "mayaMode",
    "mainWindowMenubarVis",
    "collapseIconBarsInPanels",
    "allowMenusInPanels",
    "mainWindowTitleBarVis",
    "cmdWindowTitleBarVis",
    "commandLineHoldFocus",
    "fastOutlinerSelection",
    "showIconsInMenus",
    "saveWindowPos",
    "channelsLayersSeparate",
    "EEexprEdTextEditor",
    "displayNewFeatureHighlights",
    "newFeatureHighlightColor",
    "mayaMacButtonMap",
    "useScrollWheel",
    "useMultiTouchGestures",
    "tabletAPI",
    "interfaceScalingMode",
    "interfaceScalingValue",

    //----------------------------------------------------------
	// UI Elements Preferences
	//----------------------------------------------------------
    "statusLineVisible",
    "isShelfVisible",
    "toolboxVisible",
    "timeSliderVisible",
    "playbackRangeVisible",
    "commandLineVisible",
    "helpLineVisible",
    "isAttributeEditorVisible",
    "toolSettingsVisible",
    "channelsLayersVisible",
    "channelsVisible",
    "layersVisible",

	//----------------------------------------------------------
	// Misc UI Preferences
	//----------------------------------------------------------
    "inViewMessageEnable",
    "inViewMessageAssistEnable",
    "inViewMessageStatusEnable",
    "inViewMessageDisplayTime",
    "inViewMessageFontSize",
    "inViewMessageOpacity",
    "popUpHelpMode",
    "popUpSimpleHelpMode",
    "helpBrowserUseWindow",
    "helpBrowserRaiseWindow",
    "helpLanguage",
    "helpMode",
    "interactionModeToSuite",
    "newScenePanelConfiguration",
    "useNewScenePanelConfig",
    "useScenePanelConfig",
    "useSaveScenePanelConfig",
    "ResetModelViewsOnNewScene",

	//----------------------------------------------------------
	// Display Preferences
	//----------------------------------------------------------
    "fastInteraction",
    "viewAxisVisibility",
    "toggleOriginAxis",
    "showGrid",
    "activeObjectPivots",
    "displayRegionOfEffect",
    "wireframeOnShadedActive",
    "shadeTemplates",
    "displayViewportGradient",
    "lineWidth",
    "maxTextureResolution",
    "materialLoadingMode",
    "maxImageSizeForSwatchGen",
    "generateUVTilePreviewsOnSceneLoad",
    "enableSwatchRendering",
    "vp2PauseState",
    "vp2RenderingEngine",
    "viewportRenderer",
    "bluePencilDisableGhostingDuringPlayback",
    "bluePencilTimeControlRangeMoveEnabled",
    "bluePencilIgnore2dPanZoom",
    "bluePencilTimelineFrameDisplay",
    
	//----------------------------------------------------------
	// Kinematics Display Preferences
	//----------------------------------------------------------
    "ikHandleDisplayScale",
    "ikIkFkJointDisplayScale",
    "ikIkFkDisplayMethod",
    "ikJointDisplayScale",

	//----------------------------------------------------------
	// Manipulator Preferences
	//----------------------------------------------------------
    "manipGlobalScale",
    "manipHandleSize",
    "manipLineSize",
    "manipLinePickSize",
    "manipPreviousStateSize",
    "manipMiddleMouseRepos",
    "manipsRememberActiveHandle",
    "manipsRememberActiveHandleAfterToolSwitch",
    "manipPlaneHandleOffset",
    "manipShowPlaneHandles",
    "manipPivotRotateHandleOffset",
    "manipShowPivotRotateHandle",
    "manipShowPenumbraDecayRegions",

	//----------------------------------------------------------
	// NURBS Display Preferences
	//----------------------------------------------------------
    "newCurveDisplayEP",
    "newCurveDisplayHull",
    "newCurveDisplayCV",
    "newSurfaceDisplayEP",
    "newSurfaceDisplayHull",
    "newSurfaceDisplayCV",
    "newSurfaceDisplayOrigin",
    "newNurbsIsoparms",
    "newNurbsPointsShaded",
    "newNurbsPointsWire",
    "highPrecisionNurbs",

	//----------------------------------------------------------
	// Poly Display Preferences
	//----------------------------------------------------------
    "newPolyVtxDisp",
    "newPolyVertexSize",
    "newPolyVtxBackCull",
    "newPolyVertexNormals",
    "newPolyEdgeDisp",
    "newPolyBorderEdgeSize",
    "newPolyBorderEdgeHilite",
    "newPolyBorderMapHilite",
    "newPolyCreaseEdgeHilite",
    "newPolyCreaseVertexHilite",
    "newPolyUVSize",
    "newPolyNormalSize",
    "newPolyFacetCentreDisp",
    "newPolyFacetNormalDisp",
    "newPolyFacetTrngleDisp",
    "newPolyFacetWarpDisp",
    "newPolyHoleFacesHilite",
    "newPolyNumVertexDisp",
    "newPolyNumEdgeDisp",
    "newPolyNumFacetDisp",
    "newPolyNumUvDisp",
    "newPolyColorShaded",
    "newPolyColorChannel",
    "newPolyMaterialBlend",
    "newPolyBackFaceCull",
    "newPolyDefaultSmoothDrawType",
    "globalPolyDefaultSmoothDrawType",
    "newPolyDefaultVertexNormalMethod",

	//----------------------------------------------------------
	// Subdiv Display Preferences
	//----------------------------------------------------------
	"subdivComponentDisplayStyle",

	//----------------------------------------------------------
	// Font Display Preferences
	//----------------------------------------------------------
    "fontSetOpt",
    "smallFontSize",
    "defaultFontSize",

	//----------------------------------------------------------
	// General Application Settings Preferences
	//----------------------------------------------------------
    "upAxisDirection",
    "workingUnitLinear",
    "workingUnitAngular",
    "workingUnitTime",
    "positionalTolerance",
    "tangentialTolerance",

	//----------------------------------------------------------
	// Camera Preferences
	//----------------------------------------------------------
    "animateRoll",
    "animateRollFitAll",
    "animateRollGotoBookmark",
    "animateRollNextLastCameraView",
    "totalAnimateRollTime",
    "defaultFitFactor",

	//----------------------------------------------------------
	// Animation Preferences
	//----------------------------------------------------------
    "roundRangesToWholeValue",
    "keepKeysAtCurrentFrame",
    "playbackMin",
    "playbackMax",
    "playbackMinRange",
    "playbackMaxRange",
    "timeSliderShowKeys",
    "timeSliderAnimLayerOptions",
    "timeSliderShowKeysCombined",
    "timeSliderShowUpstreamKeys",
    "timeSliderTickSize",
    "timeSliderTickSpan",
    "timeDisplayMode",
    "timeSliderSnapping",
    "timeSliderPlayView",
    "timeSliderPlayLoop",
    "timeSliderStepLoop",
    "timeSliderPlaySpeed",
    "timeSliderMaxPlaySpeed",
    "timeSliderPlayBy",
    "graphEdDisplayAssets",
    "seqDoubleClickSetTimeRange",
    "graphEdSnapToAdjacentValues",
    "stackedCurvesSpace",
    "graphEditorKeyScale",
    "graphEditorKeyMinScale",
    "graphEditorAutoFit",
    "graphEditorAutoFitTime",
    "graphEdValueLineDisplay",
    "graphEdValueLineInterval",
    "graphEdValueMinLines",
    "graphEdValueLineLength",
    "animEdCadenceLineType",
    "animEdCadenceLineFreq",
    "animEdZeroCadenceLine",
    "animEdHideTimeMarkerDuringPlayback",
    "keyUseChannelBox",
    "scaleKeyAutoSnap",
    "timeEditorGranularity",
    "timeEditorHUD",
    "deformationUseComponentTags",
    "deformationSelectionComponentTags",
    "deformationCreateTweak",
    "weightsColorOutOfRange",
    "weightsColorUseMaxMin",
    "weightsColorRampMin",
    "weightsColorRampMax",
    "weightsColorUseRamp",
    "weightsColorRamp",

	//----------------------------------------------------------
	// ViewCube Preferences
	//----------------------------------------------------------
    "viewCubeShowCube",
    "viewCubeScreenPosition",
    "viewCubeSize",
    "viewCubeInactiveOpacity",
    "viewCubeSnapToClosest",
    "viewCubeFitToView",
    "animateRollViewCompass",
    "viewCubePreserveSceneUp",
    "viewCubeShowCompass",
    "viewCubeCompassAngle",

	//----------------------------------------------------------
	// InViewEditor Preferences
	//----------------------------------------------------------
	"inViewEditorVisible",

	//----------------------------------------------------------
	// SteeringWheel Preferences
	//----------------------------------------------------------
	"steeringWheelWelcomeSeen",
	"steeringWheelBigSize",
	"steeringWheelBigOpacity",
	"steeringWheelMiniSize",
	"steeringWheelMiniOpacity",
	"steeringWheelShowToolMessages",
	"steeringWheelShowToolTips",
	"steeringWheelShowPinnedOnStartup",
	"steeringWheelInvertLookAxis",
	"steeringWheelConstrainWalkToGround",
	"steeringWheelWalkSpeedFactor",
	"steeringWheelIncrementalZoom",
	"steeringWheelKeepSceneUpright",
	"steeringWheelSelectionSensitivity",

	//----------------------------------------------------------
	// Dynamics Preferences
	//----------------------------------------------------------
	"dynPrefAutoCreate",
	"dynPrefRunupToCurrentTime",
	"dynPrefRunupFrom",
	"dynPrefSaveRuntimeState",
	"dynPrefEchoCollision",

	//----------------------------------------------------------
	// Key Preferences
	//----------------------------------------------------------
	"gpuOverride",
	"prepopulateController",
	"evaluationMode",
	"autoKeyframeState",
    "autoKeyCharacterState",
	"rotationInterpolationDefault",
	"hikRotationInterpolationDefault",
	"weightedTangents",
	"inTangentType",
	"outTangentType",
	"animBlendingOpt",
	"animBlendBrokenInputOpt",

	//----------------------------------------------------------
	// Assets Preferences
	//----------------------------------------------------------
	"containerSelRootsInOutliner",
	"containerChanBoxMaxNoTemplate",
	"containerChanBoxMaxWithTemplate",
	"containerFlatViewCap",

	//----------------------------------------------------------
	// File References Preferences
	//----------------------------------------------------------
	"refAnimCurvesEditable",
	"refLockEditable",

	//----------------------------------------------------------
	// Modeling Preferences
	//----------------------------------------------------------
    "polyAutoConvertAction",
    "polyCreateMeshesSingleSided",
    "polyAutoInstallAction",
    "polyDefaultTangentSpace",
    "polyDefaultTangentSmoothingAngle",
    "polyAutoShowColorPerVertex",
    "polyKeepFacetsGrouped",
    "bump2dUseTangentSpaceNormalsByDefault",

	//----------------------------------------------------------
	// Modeling Toolkit Preferences
	//----------------------------------------------------------
    "MT_useCompModeCustCmd",
    "MT_compModeCustCmd",
    "MT_prohibitNegativeScale",
    "MT_preSelectSize",
    "MT_selectDeadSpaceRange",
    "MT_tweakDeadSpaceRange",
    "MT_freeRotate",
    "MT_refreshActiveOnly",
    "MT_resetManipOnToolSwitch",
    "MT_resetManipOnSelChange",
    "MT_manipPickRange",
    "MT_planeHandleOffset",
    "manipHideOnCtrl",
    "manipHideOnShift",
    "manipHideOnShiftCtrl",
    "MT_hudShowMode",
    "MT_hudShowCoordSpace",
    "MT_showDynamicHUD",
    "MT_dynamicHUDColor",
    "MT_hiliteColorAdd",
    "MT_hiliteColorCutLine",
    "MT_hiliteColorCutVert",
    "MT_hiliteColorCutEdge",
    "MT_hiliteColorCutFace",
    "MT_hiliteColorSubtract",
    "MT_paintColorAdd",
    "MT_paintColorSubtract",
    "MT_activeManipColor",
    "MT_highlightOpacity",
    "MT_quaDrawMmbWeld",
    "MT_shiftSlide",
    "MT_shiftCtrlSlide",

    //----------------------------------------------------------
	// Search Preferences
	//----------------------------------------------------------
    "showHistoryOnEmptySearchField",
    "autoFillLastCommand",
    "includeCommandsInSearch",
    "includeKeywordsInResult",

    //----------------------------------------------------------
	// Selection Preferences
	//----------------------------------------------------------
	"selectSingleMarquee",
	"selectClickDrag",
	"selectAffectsActive",
	"ignoreSelectionPriority",
	"popupMenuSelection",
	"expandPopupList",
    "disableComponentPopups",
	"clickBoxSize",
	"manipClickBoxSize",
	"selectPrefPriorityMode",
	"polyFaceSensitive",
	"preSelectHilite",
	"containerCentricSelection",
	"containerAutoSelectContainer",
	"outlinerAutoSelectSetMembers",
	"selectPrefUseDepth",
	"selectPrefAutoUseDepth",
	"selectPrefPreSelectBackfacing",
	"selectPrefPreSelectClosest",
	"TrackSelectionOrder",
	"PreserveComponentSelections",
	"selectionChildHighlightMode",
    "customSelectPriority",

	//----------------------------------------------------------
	// Snapping Preferences
	//----------------------------------------------------------
	"useSnapTolerance",
	"snapTolerance",
	"snapUVTolerance",
	"snapMagnet",
	"snapMagnetTolerance",

	//----------------------------------------------------------
	// Sound Preferences
	//----------------------------------------------------------
    "timeSliderSoundDisplay",
    "timeSliderRepeatOnHold",
    "timeSliderRepeatChunk",

	//----------------------------------------------------------
	// Advanced Preferences
	//----------------------------------------------------------
	"undoIsEnabled",
	"undoIsInfinite",
	"undoLength",
	"timeChangeUndoConsolidation",

	//----------------------------------------------------------
	// Rendering Preferences
	//----------------------------------------------------------
	"preferredRenderer",
	"renderSetupEnable",
	"miCacheOptimFileTextures",
	"miFileTextureCacheStorageMode",
	"miFileTextureCacheLocation",
	"miFileTextureCacheConversionScope",
	"miUseMayaAlphaDetection",
	"miCollapseHistoryOnProxyUpdate",
    "miEnableRayTracingForSwatch",

	//----------------------------------------------------------
	// File I/O Preferences
	//----------------------------------------------------------
    "displayCrashInfo",
    "fileCompressionMode",
    "displayLayerMerge",
    "RecentFilesMaxSize",
    "RecentBackupsMaxSize",
    "RecentProjectsMaxSize",
    "FileDialogStyle",
    "FileDialogHideExtension",
    "fileIgnoreVersion",
    "canSuppressFileOpenErrorDialog",
    "autoSaveEnable",
    "autoSavePrompt",
    "autoSaveLimitBackups",
    "autoSaveMaxBackups",
    "autoSaveInterval",
    "autoSaveDestination",
    "autoSaveFolder",       // Note: this optionVar may not exist
    "MT_autoloadTextures",

	//----------------------------------------------------------
	// Modules Preferences
	//----------------------------------------------------------
	"loadDynamics",
	"loadUrchin",

	//----------------------------------------------------------
	// OpenMaya Preferences
	//----------------------------------------------------------
	"apiPrefLazyLoading",
	"apiPrefOldPluginWarning",

	//----------------------------------------------------------
	// Save Actions Preferences
	//----------------------------------------------------------
	"saveActionsPreferences",
	"saveActionsScriptEditor",

	//----------------------------------------------------------
	// Safe Mode Preferences
	//----------------------------------------------------------
    "SafeModeOption",
    "SafeModeDefaultCommandsAction",
    "TrustCenterPathOption",
    "TrustCenterPathAction",
    "SafeModeAllowedlistPaths",   // Note: this optionVar may not exist
    "TrustCenterCommandsList",  // Note: this optionVar may not exist
    "SafeModeBuiltInsBlocked",
    "SafeModeBuiltInsSuspFunct",
    "SafeModeExecUserSetupScript",
    "SafeModeUserSetupHashOption",
    "SafeModeUserSetupHash",
    "SafeModeImportOption",
    "SafeModeGlobalPy",
    "SafeModeBuiltInCheck",
    "SafeModeImportModulesList",
    "SafeModeDefaultImportAction",
    "SafeModeDefaultBuiltinAction",
    "SafeModeBatchReportLevel",

	//----------------------------------------------------------
	// Command Port Preferences
	//----------------------------------------------------------
	"commandportOpenByDefault",
	"commandportDefaultName",

	//----------------------------------------------------------
    "END_OF_LIST"
};


global proc prefsHoldCurrentState (string $mode)
//
//	$mode = "save" to save a copy of the current pref optVars
//		  = "restore" to restore the values from the saved version
//		  = "delete" to delete the temporary option vars
//
{
	//----------------------------------------------------------
	// Preferences managed by the Python class OptionVarManager
	//----------------------------------------------------------
	python( "from maya.app.prefs.OptionVarManager import OptionVarManager" );
	if( $mode == "save" )
	{
		python( "OptionVarManager.remember_states( category='preferences' )" );
	}
	else if( $mode == "restore" )
	{
		python( "OptionVarManager.restore_states( category='preferences' )" );
	}

	//----------------------------------------------------------
	// Preferences
	//----------------------------------------------------------
    global string $gOptionVarPrefs[];
    prefsHoldOptionVars($gOptionVarPrefs, $mode);

	//----------------------------------------------------------
	// Version specific help URLs
	//----------------------------------------------------------
    global string $gMayaVersionYear;
    string $helpOptionVars[] = {
        ("localHelpUrl" + $gMayaVersionYear),
        ("customPathHelpUrl" + $gMayaVersionYear)
    };
    prefsHoldOptionVars($helpOptionVars, $mode);

	// ADSK_CLR_MGT_BEGIN
	//----------------------------------------------------------
	// Color Management Preferences
	//----------------------------------------------------------
	//
	// source is a directive, unconditionally processed when this file
	// is sourced, so irrelevant whether source is inside conditional
	// or not.
	source "colorManagementUtilities.mel";
	catch(`colorManagementPrefsHoldCurrentState($mode)`);

	// ADSK_CLR_MGT_END

	//----------------------------------------------------------
	// Modeling Type/Tools Preference
	//----------------------------------------------------------
	if ($mode == "save") {
		optionVar -iv "modelWithTypeHold" `modelWithType(-1)`;
		optionVar -iv "modelWithToolsHold" `modelWithToolsAll(-1)`;
	} else if ($mode == "restore") {
        if (`optionVar -ex modelWithTypeHold`) {
	    	$oldVal = `optionVar -q modelWithTypeHold`;
		    if ($oldVal != -1) modelWithType($oldVal);
        }
        if (`optionVar -ex modelWithToolsHold`) {
    		$oldVal = `optionVar -q modelWithToolsHold`;
    		if ($oldVal != -1) modelWithToolsAll($oldVal);
        }
	} else {
		optionVar -remove "modelWithTypeHold";
		optionVar -remove "modelWithToolsHold";
	}

	//----------------------------------------------------------
	// Node Editor Preferences
	//----------------------------------------------------------
	global string $gNodeEdGlobalOptionsKeys[];
    prefsHoldOptionVars($gNodeEdGlobalOptionsKeys, $mode);

	//----------------------------------------------------------
	// Custom Preferences
	//----------------------------------------------------------
	global string $gPrefsCustomTabHoldCurrentState[];
	string $holdCurrentStateFn;
	for($holdCurrentStateFn in $gPrefsCustomTabHoldCurrentState) {
		catch(`eval $holdCurrentStateFn $mode`);
	}
}
