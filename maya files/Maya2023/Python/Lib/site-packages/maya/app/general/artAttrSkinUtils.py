import maya.cmds as cmds
import maya.api.OpenMaya as om
import maya.mel as mel

def marking_menu_change_select_mode( item ):
    '''
    Updates the selection mode when initializing the Paint Skin Weights
    tool from the marking menu for the item underneath the cursor.
    
    The Paint Skin Weights Tool supports automatic conversion of components
    on tool initialization. In order to ensure that this works correctly
    with marking menu changeSelectMode, we inspect the current selection state
    and only change the select mode to select the item if its components
    are not already selected.
    '''
    sel = om.MSelectionList()
    sel.add( item )
    item_path = sel.getDagPath(0)
    item_path.extendToShape()
    
    sel = om.MGlobal.getActiveSelectionList()
    for i in range(sel.length()):
        (path, comp) = sel.getComponent(i)
        path.extendToShape()
        if not path == item_path:
            continue
        
        if comp.isNull():
            continue
            
        if not comp.apiType() == om.MFn.kMeshEdgeComponent and not comp.apiType() == om.MFn.kMeshPolygonComponent:
            continue
            
        # If we have reached this point then we do not want to change select mode
        # since we have valid components selected for conversion.
        return
    
    # If we reached this point, then there are no available components to convert
    # for the given item path. Change select mode and add the object to the selection.
    mel.eval('changeSelectMode -object')
    cmds.select(item, add=True)
    
    # ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
