import maya
from maya.OpenMayaUI import MQtUtil

import shiboken2
from PySide2 import QtWidgets

def _getQtObject(path):
    """ returns the main maya window """
    ptr = MQtUtil.findControl(path)
    return shiboken2.wrapInstance(int(ptr), QtWidgets.QWidget)

def findShelfButton(tabName, command):
    shelfLayoutPath = maya.mel.eval("global string $gShelfTopLevel;$temp = $gShelfTopLevel;")
    shelfTabNames = maya.cmds.shelfTabLayout(shelfLayoutPath, q=True, childArray=True)
    for tabNameScriptName in shelfTabNames:
        if tabNameScriptName == tabName:
            maya.cmds.shelfTabLayout(shelfLayoutPath, e=True, selectTab=tabName)

            modelingShelfLayout = shelfLayoutPath+"|"+tabNameScriptName

            layoutChildren = maya.cmds.shelfLayout(modelingShelfLayout, q=True, childArray=True)
            for child in layoutChildren:
                path = modelingShelfLayout+"|"+child
                # need to check for existance because separators are not buttons
                if maya.cmds.shelfButton(path, q=True, exists=True): 
                    buttonCommand = maya.cmds.shelfButton(path, q=True, command=True)
                    if buttonCommand == command:
                        return _getQtObject(path)
    return None
    

def findToolboxToolButton(name):
    buttonPath = maya.cmds.toolButton(name, q=True, fullPathName=True)
    return _getQtObject(buttonPath)

def findSearchToolIcon():
    buttonPath = maya.cmds.iconTextCheckBox("mayaSearchToolBoxIcon", q=True, fullPathName=True)
    return _getQtObject(buttonPath)

def findStatusLineButton(name):
    buttonPath = maya.cmds.iconTextCheckBox(name, q=True, fullPathName=True)
    return _getQtObject(buttonPath)

def findViewports():
    mainPane = maya.mel.eval(
        "global string $gMainPane;$temp = $gMainPane;")
    return _getQtObject(mainPane)

def findChannelBox():
    channelBox = maya.mel.eval(
        "global string $gChannelBoxName;$temp = $gChannelBoxName;")
    return _getQtObject(channelBox)

# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
