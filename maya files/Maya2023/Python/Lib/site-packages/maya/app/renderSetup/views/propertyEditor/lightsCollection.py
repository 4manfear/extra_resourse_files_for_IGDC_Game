import maya.app.renderSetup.views.propertyEditor.collection as collection
import maya.app.renderSetup.common.utils as commonUtils
import maya.app.renderSetup.views.utils as utils
from maya.app.renderSetup.views.propertyEditor.collectionPropertyEditorStrings import *

import maya.cmds as cmds

from functools import partial

# Layout inter-widget vertical, horizontal spacing.
hSpc = 10

class LightsCollection(collection.Collection):

    def __init__(self, item, parent):
        super(LightsCollection, self).__init__(item, parent)

    def postSelector(self):
        cmds.setParent(self._layoutName)
        
        form = cmds.formLayout(numberOfDivisions=100)

        buttonWidth = 50

        # Buttons to select and to view the selector output.
        selectAllBtn = cmds.button(
            label=kSelectAll, width=buttonWidth, annotation=kSelectAllTooltip,
            command=partial(LightsCollection._selectAllCb, self))

        viewAllBtn = cmds.button(
            label=kViewAll, width=buttonWidth, annotation=kViewAllTooltip,
            command=partial(LightsCollection._viewAllCb, self))

        cmds.formLayout(
            form, edit=True,
            attachForm=[(selectAllBtn,  'top',   0),
                        (selectAllBtn,  'right', hSpc+buttonWidth),
                        (viewAllBtn,    'top',   0)],
            attachControl=[(viewAllBtn,    'right', hSpc, selectAllBtn)])

        cmds.setParent('..')

    def _selectAllCb(self, data):
        objects = self._getObjects()
        shapes = [o for o in objects if cmds.objectType(o, isAType='shape')]
        commonUtils.echoSelect(shapes)

    def _viewAllCb(self, data):
        """On view button click, show modal window with list of objects."""
        objects_dict = {o:set([]) for o in self._getObjects()}
        utils.RenderSetupNodeListView(kViewCollectionObjects, self.parentWidget()).showViewAllWindow(objects_dict, list(self.getModelSelector().nodes()))
# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
