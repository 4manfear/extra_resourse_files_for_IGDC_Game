import maya.api.OpenMaya as om
import maya.cmds as cmds

def findNodeFromMaya(nodeName):
	try:
		s = om.MSelectionList()
		s.add(nodeName)
		if s.isEmpty():
			return None
		return s.getDependNode(0)
	except:
		return None		

def findSelectedNodeFromMaya():
	s = om.MGlobal.getActiveSelectionList()
	if s.isEmpty():
		return None
	return s.getDependNode(0)

def createDynamicAttribute(nodeName, attrName, attrType, value):
	result = cmds.listAttr(nodeName, string=attrName)
	if not result:
		cmds.addAttr(nodeName, longName=attrName, attributeType=attrType, defaultValue=value)

# TODO: implement expanded state appropriately by using code in renderSetup/model/expandedState.py
# TODO: The following functions should be removed and use expandedState.py instead
import maya.app.renderSetup.model.plug as plug
import maya.app.renderSetup.common.utils as commonUtils
kExpandedStateString = "expandedState"

def setExpandedState(node, value):
	""" Sets an attribute on the node storing the expanded state of
	this node in the view. Creates it if it doesn't exist """

	# Get the plug associated with the expanded state attribute
	plugRef = commonUtils.findPlug(node, kExpandedStateString)
	if plugRef is None:
		# If it doesn't exist, we create it. It's a Plug object, Python side
		plugRef = plug.Plug.createAttribute(node, kExpandedStateString,
			kExpandedStateString, {'type': 'Bool', 'connectable': False},
			plug.kNotUndoable)
		plugRef.value = value
	else:
		# If it already exists, we set its value. It's a MPlug object, OpenMaya side
		plugRef.setBool(value)

def getExpandedState(node):
	""" Retrieves the expanded state attribute of the node """

	plugRef = commonUtils.findPlug(node, kExpandedStateString)

	# If the attribte doesn't exist, just return False
	return plugRef.asBool() if plugRef is not None else False
# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
