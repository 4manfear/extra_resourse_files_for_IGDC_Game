import maya
maya.utils.loadStringResourcesForModule(__name__)

import maya.cmds
import maya.internal.common.ae.template as aetemplate
import maya.internal.common.ae.ramp as aeramp
import maya.internal.nodes.common.componenttag.component_tag_edit as ctag_edit
from maya.common.ui import LayoutManager

class ProxSubsetFieldGrp(ctag_edit.ComponentTagExpressionFieldGrp):
    def getGeometryPlug(self, nodeName, plugName):
        return '{}.proximityGeometry'.format(nodeName)

class AETemplate(aetemplate.Template):
    def buildUI(self, nodeName):
        with aetemplate.Layout(self, maya.stringTable['y_maya_internal_nodes_proximityfalloff_ae_template.kLabelProximityFalloffAttr' ]):
            self.addControl('useOriginalGeometry')
            self.addControl('vertexSpace')
            self.addControl('volume')
            self.defineQtCustom(ProxSubsetFieldGrp, ["proximitySubset"])
            self.addControls(['start', 'end'])
            self.defineCustom(aeramp.RampControl(), ['ramp'])

            with aetemplate.Layout(self, maya.stringTable['y_maya_internal_nodes_proximityfalloff_ae_template.kBindTags' ], collapse=False):
                self.addControl('useBindTags', callback=self.__useBindTagsCheck)
                self.addControl('bindTagsFilter')

            self.suppress('ramp')
            self.suppress('outputWeightFunction')

        self.callTemplate('dependNode')

    @staticmethod
    def __useBindTagsCheck(nodeName):
        useBindTags = maya.cmds.getAttr('{}.useBindTags'.format(nodeName))
        maya.cmds.editorTemplate(dimControl=[nodeName, 'bindTagsFilter', not useBindTags])
# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
