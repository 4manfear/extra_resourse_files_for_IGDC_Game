import maya
maya.utils.loadStringResourcesForModule(__name__)

import maya.cmds as cmds
import maya.mel as mel
import maya.internal.nodes.geometryfilter.ae_template as gfae
from maya.internal.common.ae.template import Layout
import maya.internal.common.ae.custom as aecustom





class AETemplate(gfae.AETemplate):
    def inputAttributesTableHiddenColumns(self):
        return [gfae.eColumn.kFal]
    def buildUI(self, nodeName):
        with Layout(self,  maya.stringTable[ 'y_maya_internal_nodes_sculpt_ae_template.kSculptHistory'  ], False):
            self.addControl("mode", callback=AETemplate._checkSculptMode)
            self.addControl("insideMode", callback=AETemplate._checkInsideMode)
            self.addControl("maximumDisplacement")
            self.addControl("dropoffType")
            self.addControl("dropoffDistance")
            #self.defineCustom(MaximumDisplacementControl(), [_NOL10N("maximumDisplacement")])

            with Layout(self,  maya.stringTable[ 'y_maya_internal_nodes_sculpt_ae_template.kSculptAdvancedHistory'  ], True):
                mel.eval("source AEsculptTemplate;AEsculptTemplateAdvance();")

        self.suppress("startPosition")
        self.suppress("extendedEnd")

        super(AETemplate, self).buildUI(nodeName)



    @staticmethod
    def _checkSculptMode(nodeName):
        plug = "%s.%s"%(nodeName, "mode")
        value = cmds.getAttr(plug)
        if value == 2: #stretch mode
            conns = cmds.listConnections( "%s.%s"%(nodeName, "startPosition"), d=False)
            if not conns or len(conns) == 0:
                cmds.evalDeferred("sculpt -e -mode stretch %s"%nodeName)

    @staticmethod
    def _checkInsideMode(nodeName):
        plug = "%s.%s"%(nodeName, "insideMode")
        value = cmds.getAttr(plug)
        if value == 1: #even mode
            conns = cmds.listConnections( "%s.%s"%(nodeName, "startPosition"), d=False)
            if not conns or len(conns) == 0:
                cmds.evalDeferred("sculpt -e -insideMode even %s"%nodeName)


# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
