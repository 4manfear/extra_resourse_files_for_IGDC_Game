import maya
maya.utils.loadStringResourcesForModule(__name__)

import maya.cmds as cmds
import maya.internal.nodes.weightgeometryfilter.ae_template as wgfae
import maya.internal.nodes.skincluster.node_interface as ifc # this import line must be here to ensure the node_interface class is registered
from maya.internal.common.ae.template import Layout

class AETemplate(wgfae.AETemplate):

    @staticmethod
    def updateDQSProperties(nodename):
        method = cmds.getAttr("{}.skinningMethod".format(nodename))
        cmds.editorTemplate(dimControl=[nodename, "dqsSupportNonRigid", method == 0])

        supported = cmds.getAttr("{}.dqsSupportNonRigid".format(nodename))
        cmds.editorTemplate(dimControl=[nodename, "dqsScale", method == 0 or not supported])

    @staticmethod
    def checkObeyMaxInfl(nodename):
        value = cmds.getAttr("{}.maintainMaxInfluences".format(nodename))
        cmds.editorTemplate(dimControl=[nodename, "maxInfluences", not value])

    @staticmethod
    def checkNormalizeWeights(nodename):
        value = cmds.getAttr("{}.normalizeWeights".format(nodename))
        cmds.editorTemplate(dimControl=[nodename, "weightDistribution", value != 1])

    def buildUI(self, nodeName):
        with Layout(self, maya.stringTable['y_maya_internal_nodes_skincluster_ae_template.kSmoothSkinAttributes' ], False):
            cmds.editorTemplate(beginNoOptimize=True)
            self.addControl("skinningMethod", callback=self.updateDQSProperties)
            self.addControl("useComponents")
            self.addControl("deformUserNormals")
            self.addControl("dqsSupportNonRigid", label=maya.stringTable[ 'y_maya_internal_nodes_skincluster_ae_template.kDQSNonRigidSupport' ], callback=self.updateDQSProperties)
            self.addControl("dqsScale", label=maya.stringTable[ 'y_maya_internal_nodes_skincluster_ae_template.kDQSScale' ])
            cmds.editorTemplate(endNoOptimize=True)

            cmds.editorTemplate(addSeparator=True)
            self.addControl("normalizeWeights", callback=self.checkNormalizeWeights)
            self.addControl("weightDistribution")
            self.addControl("maxInfluences")
            self.addControl("maintainMaxInfluences", callback=self.checkObeyMaxInfl)

        self.suppress("lockWeights")
        self.suppress("weightList")
        self.suppress("bindPreMatrix")
        self.suppress("geomMatrix")
        self.suppress("matrix")
        self.suppress("dropoffRate")
        self.suppress("dropoff")
        self.suppress("bindMethod")
        self.suppress("driverPoints")
        self.suppress("basePoints")
        self.suppress("baseDirty")
        self.suppress("paintWeights")
        self.suppress("paintTrans")
        self.suppress("paintArrDirty")
        self.suppress("nurbsSamples")
        self.suppress("smoothness")
        self.suppress("useComponentsMatrix")
        self.suppress("wtDrty")
        self.suppress("blendWeights")

        super(AETemplate, self).buildUI(nodeName)
# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
