import maya
maya.utils.loadStringResourcesForModule(__name__)

import maya.internal.common.ae.template as aetemplate
import maya.internal.nodes.weightgeometryfilter.ae_template as ae
import maya.internal.nodes.common.componenttag.component_tag_edit as ctag_edit
import maya.cmds as cmds

USE_BORDER_FALLOFF = "useBorderFalloff"
BORDER_FALLOFF_BLUR = "borderFalloffBlur"
SCALE_MODE = "scaleMode"
SCALE_ENVELOPE = "scaleEnvelope"

#-------------------------------------------------------------------------------
def checkUseBorderFalloff(nodeName):
    value = cmds.getAttr(nodeName + "." + USE_BORDER_FALLOFF)
    cmds.editorTemplate(dimControl=[nodeName, BORDER_FALLOFF_BLUR, value == 0])

#-------------------------------------------------------------------------------
def checkScaleEnvelope(nodeName):
    value = cmds.getAttr(nodeName + "." + SCALE_MODE)
    cmds.editorTemplate(dimControl=[nodeName, SCALE_ENVELOPE, value == 0])

#-------------------------------------------------------------------------------
class IslandFieldGrp(ctag_edit.ComponentTagExpressionFieldGrp):
    def getGeometryPlug(self, nodeName, plugName):
        indices = cmds.getAttr('{}.input'.format(nodeName), multiIndices=True)
        if indices and len(indices) > 0:
            return '{}.input[{}].inputGeometry'.format(nodeName, indices[0])
        else:
            return None

#-------------------------------------------------------------------------------
class AETemplate(ae.AETemplate):
    def buildUI(self, nodeName):
        with aetemplate.Layout(self, maya.stringTable['y_maya_internal_nodes_solidify_ae_template.kSolidifyAttributes' ], collapse=True):
            self.addControl("attachmentMode")
            self.defineQtCustom(IslandFieldGrp, ["islands"])
            self.addControl("stabilizationLevel")
            self.addControl(USE_BORDER_FALLOFF, callback=checkUseBorderFalloff)
            self.addControl(BORDER_FALLOFF_BLUR)
            with aetemplate.Layout(self, maya.stringTable['y_maya_internal_nodes_solidify_ae_template.kSolidifyScaling' ], collapse=False):
                self.addControl("normalScale")
                self.addControl("tangentPlaneScale")
                self.addControl(SCALE_MODE, callback=checkScaleEnvelope)
                self.addControl(SCALE_ENVELOPE)


        super(AETemplate, self).buildUI(nodeName)






# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
