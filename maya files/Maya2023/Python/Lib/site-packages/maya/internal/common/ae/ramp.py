import maya
maya.utils.loadStringResourcesForModule(__name__)

from builtins import object
import maya.cmds
import maya.mel
import maya.internal.common.ae.custom as aecustom

TOP =  "top"
BOTTOM = "bottom"
RIGHT = "right"
LEFT = "left"

# --------------------------------------------------------------------------------------------------
class RampWidget(object):

    def __init__(self, attribute):
        self.attribute = attribute

    def buildUI(self):
        # Prepare
        parent = maya.cmds.setParent(q=True)
        maya.cmds.setUITemplate('attributeEditorTemplate', pushTemplate=True)

        niceName = maya.cmds.attributeName(self.attribute, nice=True)

        self.frm = maya.cmds.frameLayout( label=niceName, collapsable=True, collapse=False )

        # Widgets
        maya.cmds.columnLayout(rowSpacing=2)
        rampForm = maya.cmds.formLayout()
        spc	=  maya.cmds.attrFieldSliderGrp(label=maya.stringTable['y_maya_internal_common_ae_ramp.kPos' ], cw=(1,123))
        scc	=  maya.cmds.attrFieldSliderGrp(label=maya.stringTable['y_maya_internal_common_ae_ramp.kVal' ], cw=(1,123))
        interp = maya.cmds.attrEnumOptionMenuGrp(label=maya.stringTable[ 'y_maya_internal_common_ae_ramp.kInterp' ], cw=(1,123))
        self.editButton = maya.cmds.button(label=maya.stringTable['y_maya_internal_common_ae_ramp.kLabelEditRamp' ], width=23, command=self.editButtonPressed)

        rframe = maya.cmds.frameLayout(lv=0, cll=0, parent=rampForm)

        self.rampGrad = maya.cmds.gradientControl(snc=0, sp=0, w=135, h=74, at=self.attribute)

        maya.cmds.formLayout(rampForm, edit=True,
			    attachForm=[
                    (spc, LEFT,  0),
                    (spc, TOP, 0),
                    (scc, LEFT, 0 ),
                    (interp, LEFT, 0 ),
                    (rframe, TOP, 0),
                    (self.editButton, TOP, 0),
                    (self.editButton, BOTTOM, 0)] ,
				attachControl=[
                    (scc, TOP, 0, spc),
                    (interp, TOP, 0, scc),
                    (rframe, LEFT, 2, interp),
                    (self.editButton, LEFT, 5, rframe)],
				attachNone=[
                    (spc, RIGHT),
                    (spc, BOTTOM),
                    (scc, RIGHT),
                    (scc, BOTTOM),
                    (interp, RIGHT),
                    (interp, BOTTOM),
                    (rframe, RIGHT),
                    (rframe, BOTTOM),
                    (self.editButton, RIGHT)]
                )

        maya.cmds.gradientControl(self.rampGrad, edit=True, scc=scc)
        maya.cmds.gradientControl(self.rampGrad, edit=True, spc=spc)
        maya.cmds.gradientControl(self.rampGrad, edit=True, sic=interp)

        # Finish
        maya.cmds.setUITemplate(popTemplate=True)
        maya.cmds.setParent(parent)

    def setAttribute(self, attribute):
        self.attribute = attribute
        if self.attribute:
            maya.cmds.frameLayout( self.frm, edit=True, label=maya.cmds.attributeName(self.attribute, nice=True))
            maya.cmds.gradientControl(self.rampGrad, edit=True, at=self.attribute)
        else:
            maya.cmds.gradientControl(self.rampGrad, edit=True, cla=True)

    def setNode(self, nodeName):
        if self.attribute:
            parts = self.attribute.split('.', 1)
            if len(parts) == 2:
                self.setAttribute(attribute=u'{0}.{1}'.format(nodeName, parts[1]))

    def editButtonPressed(self, *args):
        # print "Button pressed {0}".format(self.attribute)
        if self.attribute:
            maya.mel.eval(u'editRampAttribute {0}'.format(self.attribute))

    def setEnable(self, enable):
        maya.cmds.frameLayout(self.frm, edit=True, enable=enable)

# --------------------------------------------------------------------------------------------------
class RampControl(aecustom.CustomControl):

    def __init__(self):
        super(RampControl,self).__init__()

    def buildControlUI(self):
        self.rampWidget = RampWidget(attribute=self.plugName)
        self.rampWidget.buildUI()

    def replaceControlUI(self):
        self.rampWidget.setNode(self.nodeName)

# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
