'''
Maya Instruction on how to create a control for a boolean attribute

Boolean are special since they can be grouped together,
that is why the replace function take an extra index parameter.
Read the Readme.md for further information
'''

from builtins import zip
import maya.cmds as cmds
from . import template
import maya.internal.common.utils.ui as ui
from maya.common.ui import LayoutManager,ParentManager

valueFld = "valueFld"

def replaceSingleBool(controlName, plugName, attrName, changedCommand):
    node = template.plugNode(plugName)
    attr = template.plugLastMultiAttr(plugName)
    index = 1 if cmds.attributeQuery(attr, node=node, multi=True) else 2
    cmds.connectControl(controlName, plugName, index=index)
    template.attachCallback(plugName,controlName,changedCommand)

def createSingleBool(plugName, attrName, changedCommand):
    createdControl = cmds.checkBoxGrp(ncb=1, l1=attrName)
    replaceSingleBool(createdControl, plugName, attrName, changedCommand)

def replace(controlName, plugName, attrName, changedCommand, index):
    with ParentManager(controlName):
        keywords = {"label" + str(index): attrName, "e":True}
        cmds.checkBoxGrp(valueFld, **keywords)

        cmds.connectControl(valueFld, plugName, index=index+1)

        fields = cmds.layout(valueFld, q=True, ca=True)
        template.attachCallback(plugName, fields[index-1], changedCommand)


def create(plugsName, attrNames, changedCommand):
    cmds.setUITemplate("attributeEditorTemplate", pushTemplate=True)
    createdControl = cmds.formLayout()
    with LayoutManager(createdControl):
        if not isinstance(attrNames, list):
            attrNames = [attrNames]
            changedCommand = [changedCommand]

        attrCount = len(attrNames)

        cmds.checkBoxGrp(valueFld, ncb=attrCount)

        cmds.checkBoxGrp(valueFld, e=True, **{"l" + str((i + 1)) : a for i, a in enumerate(attrNames)})

        cmds.formLayout(createdControl,
            e=True,
            af=[(valueFld, ui.TOP, 0),
                (valueFld, ui.LEFT, 0),
                (valueFld, ui.RIGHT, 0),
                (valueFld, ui.BOTTOM, 0)
            ])
        # get a list of the sub-components of the checkboxgrp,
        # so that each scriptJob can be attached to a unique
        # component (making it easier to replace them in AEreplaceBoolean.mel)
        #
        changedCommand = changedCommand if changedCommand else [None]*len(plugsName) #if changedCommand is empty, zip wont work
        subC = cmds.layout(valueFld, q=True, ca=True)
        for i, (plugName, cc) in enumerate(zip(plugsName,changedCommand)):
            cmds.connectControl(valueFld, plugName, index=i+2)
            template.attachCallback(plugName, subC[i], cc)

    cmds.setUITemplate(popTemplate=True)
    return createdControl# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
