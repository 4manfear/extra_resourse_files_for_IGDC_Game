'''
Maya Instruction on how to create a control for a matrix attribute

Read the Readme.md for further information
'''

from maya.OpenMayaUI import MQtUtil
from maya.internal.common.utils.connections import plugNode

import maya.internal.common.ae.custom as aecustom

try:
    from maya.internal.common.ae.matrix_widget import MatrixWidget
    from shiboken2 import getCppPointer, wrapInstance
    useShiboken2 = True
except ImportError:
    useShiboken2 = False

def replace(controlName, plugName, attrName, changeCommand):
    if not useShiboken2:
        return ""

    matrixWidgetPtr = MQtUtil.findControl(controlName)
    from sys import version_info as sys_version_info
    long_type = int if sys_version_info[0] >= 3 else long
    matrixWidget = wrapInstance(long_type(matrixWidgetPtr), MatrixWidget)
    matrixWidget.changeNode(plugNode(plugName), plugName)

def create(plugName, attrName, changedCommand ):
    if not useShiboken2:
        return ""

    customObj = aecustom.QtCustomControl(MatrixWidget)
    customObj.onCreate([plugName], attrName, changedCommand)
    from sys import version_info as sys_version_info
    long_type = int if sys_version_info[0] >= 3 else long
    newWidgetName = MQtUtil.fullName(long_type(getCppPointer(customObj.myWidget)[0]))
    return newWidgetName

# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
