'''
UFE instruction on how to create a control for a string attribute.

Read the Readme.md for further information
'''

import maya.cmds as cmds

import maya.internal.ufeSupport.attributes as attributes

def updateUi(attr, uiControlName):
    '''Callback function to update the UI when the data model changes.'''
    cmds.textFieldGrp(uiControlName, edit=True, text=attr.get())

    # Update the appearance and read-only status of control.
    isLocked = attributes.isAttributeLocked(attr)
    bgClr = attributes.getAttributeColorRGB(attr)
    fieldControl = '%s|%s' % (uiControlName, 'field')
    if cmds.textField(fieldControl, exists=True):
        cmds.textField(fieldControl, e=True, editable=not isLocked)
        if bgClr:
            cmds.textField(fieldControl, e=True, backgroundColor=bgClr)

def replace(controlName, ufeAttr, attrUIName, changedCommand):
    updateUi(ufeAttr, controlName)
    cmds.textFieldGrp(controlName, e=True, label=attrUIName)
    attachCallbacks(ufeAttr, controlName, changedCommand)

def create(ufeAttr, attrUIName, changedCommand):
    uiControl = cmds.textFieldGrp(label=attrUIName)
    pMenu = attributes.AEPopupMenu(uiControl, ufeAttr)
    updateUi(ufeAttr, uiControl)
    attachCallbacks(ufeAttr, uiControl, changedCommand)

    return uiControl

def attachCallbacks(ufeAttr, uiControl, changedCommand):
    # Create change callback for UFE and UI value synchronization.
    cb = attributes.createChangeCb(updateUi, ufeAttr, uiControl)
    cmds.textFieldGrp(uiControl, edit=True, changeCommand=cb)
# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
