'''
General test utilities.
'''

from builtins import object
from builtins import range
import maya.cmds

# ==============================================================================
class GeometryCapture(object):
    '''Class to help capture certain verts or cvs of a shape'''
    def __init__(self, shape, indices):
        self.op = list()
        self.shape = shape
        self.indices = indices
        self.asMesh = maya.cmds.objectType(self.shape, isAType='mesh')

    def captureBasePoints(self):
        self.op = self.capturePoints()

    def capturePoints(self):
        pts = list()

        if self.asMesh:
             for i in self.indices:
                pts.append(maya.cmds.pointPosition(u'{0}.vtx[{1}]'.format(self.shape, i)))
        else:
             for i in self.indices:
                pts.append(maya.cmds.pointPosition(u'{0}.cv[{1}][{2}]'.format(self.shape, i[0], i[1])))
        return pts

    @staticmethod
    def pointDiff(p, q):
        return [p[0]-q[0], p[1]-q[1], p[2]-q[2]]

    def captureMovement(self):
        cp = self.capturePoints()

        n = len(self.op)
        if len(cp) != n:
            return []

        pts = list()
        for i in range(0, n):
            pts.append(self.pointDiff(cp[i], self.op[i]))
        return pts

# ==============================================================================
def pointListString(pts):
    s = ''
    for p in pts:
        s += ', ' if s else ''
        s += ('[{0:.6f} , {1:.6f}, {2:.6f}]'.format(p[0], p[1], p[2]))
    return u'[{0}]'.format(s)

# ==============================================================================
def setComponentTagTestingPrefs(old):
    maya.cmds.optionVar(iv=('deformationUseComponentTags', not old))
    maya.cmds.optionVar(iv=('deformationCreateTweak', old))
# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
