import maya
maya.utils.loadStringResourcesForModule(__name__)

import maya.cmds as cmds
from maya.app.prefs.OptionVar import option_var_set_value, OPTION_VAR_TYPE_INT, OPTION_VAR_TYPE_STRING
from maya.common.ui import setClipboardData
import maya
maya.utils.loadStringResourcesForModule(__name__)

EXPORT_SCRIPT_TEMPLATE = """
from maya.ge.applyThemes import apply_theme_colors
current_colors = {current_colors}
apply_theme_colors(current_colors)
"""

DARK_THEME_NAME = "dark"
CLASSIC_THEME_NAME = "classic"
LIGHT_THEME_NAME = "light"
COLORBLIND_THEME_NAME = "colorblind"
TRS_DISTINCT_THEME_NAME = "trs_distinct"

def _get_dark_theme_colors():
    return {
        "modernGraphEditorTranslateZColor": [0.29412, 0.69804, 1.00000],
        "modernGraphEditorScaleYColor": [0.28235, 0.78431, 0.15686],
        "modernGraphEditorVisibilityColor": [0.58824, 0.62745, 0.58824],
        "modernLockedCurveColor": [0.54902, 0.54902, 0.54902],
        "modernGraphEditorRotateYColor": [0.28235, 0.78431, 0.15686],
        "modernGraphEditorGrid": [0.33333, 0.33333, 0.33333],
        "modernGraphEditorScaleZColor": [0.29412, 0.69804, 1.00000],
        "modernGraphEditorRotateXColor": [1.00000, 0.28235, 0.30588],
        "modernGraphEditorTimeMarkerColor": [1.00000, 1.00000, 0.00000],
        "modernGraphEditorTimeRulerTickColor": [0.34118, 0.34118, 0.34118],
        "modernSliderOutPlayRangeOPACITY": [0.2, 0.2, 0.2],
        "modernGraphEditorBufferCurveColor": [0.09804, 0.09804, 0.09804],
        "modernGraphEditorTranslateYColor": [0.28235, 0.78431, 0.15686],
        "modernGraphEditorBreakDownKeyColor": [0.00000, 1.00000, 0.00000],
        "modernSecondarySelectionColor": [0.54902, 0.54902, 0.54902],
        "modernPreSelectHighlight": [1.00000, 1.00000, 1.00000],
        "modernGraphEditorKeyOnBufferCurveColor": [0.09804, 0.09804, 0.09804],
        "modernGraphEditorRegionSelectBackground": [0.50196, 0.50196, 0.50196],
        "modernPrimarySelectionColor": [1.00000, 1.00000, 1.00000],
        "modernOutPlayRangeColor": [0.08627, 0.08627, 0.08627],
        "modernGraphEditorRotateZColor": [0.29412, 0.69804, 1.00000],
        "modernGraphEditorDefaultKeyColor": [1.00000, 0.66667, 0.00000],
        "modernGraphEditorTimeRulerLabelColor": [0.66667, 0.66667, 0.66667],
        "modernGraphEditorTranslateXColor": [1.00000, 0.28235, 0.30588],
        "modernGraphEditorBackground": [0.23922, 0.23922, 0.23922],
        "modernLockedKeyColor": [0.00000, 0.00000, 0.00000],
        "modernGraphEditorGridAxis": [0.50980, 0.50980, 0.50980],
        "modernGraphEditorTimeRulerBackgroundColor": [0.19608, 0.19608, 0.19608],
        "modernValueLabel": [0.66667, 0.66667, 0.66667],
        "modernGraphEditorScaleXColor": [1.00000, 0.28235, 0.30588]
    }

def _get_trs_distinct_theme_colors():
    adjusted_dark_theme_colors = _get_dark_theme_colors()
    adjusted_dark_theme_colors.update( {
        "modernGraphEditorTranslateZColor": [0.29412, 0.76863, 1.00000],
        "modernGraphEditorScaleYColor": [0.00000, 0.58824, 0.43137],
        "modernGraphEditorRotateYColor": [0.78431, 0.78431, 0.07059],
        "modernGraphEditorScaleZColor": [0.31373, 0.47451, 1.00000],
        "modernGraphEditorRotateXColor": [1.00000, 0.55294, 0.28235],
        "modernGraphEditorTranslateYColor": [0.15686, 0.78431, 0.25882],
        "modernGraphEditorRotateZColor": [0.67451, 0.47059, 1.00000],
        "modernGraphEditorTranslateXColor": [1.00000, 0.28235, 0.30588],
        "modernGraphEditorScaleXColor": [1.00000, 0.39608, 0.81961]
    })
    return adjusted_dark_theme_colors

def _get_colorblind_theme_colors():
    adjusted_dark_theme_colors = _get_dark_theme_colors()
    adjusted_dark_theme_colors.update({
        "modernGraphEditorTranslateZColor": [0.32941, 0.54510, 1.00000],
        "modernGraphEditorScaleYColor": [0.29020, 0.83137, 0.59608],
        "modernGraphEditorVisibilityColor": [0.62745, 0.62745, 0.62745],
        "modernGraphEditorRotateYColor": [0.29020, 0.83137, 0.59608],
        "modernGraphEditorScaleZColor": [0.32941, 0.54510, 1.00000],
        "modernGraphEditorRotateXColor": [1.00000, 0.21961, 0.17255],
        "modernGraphEditorTranslateYColor": [0.29020, 0.83137, 0.59608],
        "modernGraphEditorBreakDownKeyColor": [0.00000, 1.00000, 1.00000],
        "modernGraphEditorRotateZColor": [0.32941, 0.54510, 1.00000],
        "modernGraphEditorTranslateXColor": [1.00000, 0.21961, 0.17255],
        "modernGraphEditorScaleXColor": [1.00000, 0.21961, 0.17255]
    })
    return adjusted_dark_theme_colors

def _get_light_theme_colors():
    return {
        "modernGraphEditorTranslateZColor": [0.07843, 0.73333, 0.87059],
        "modernGraphEditorScaleYColor": [0.29020, 0.78431, 0.30980],
        "modernGraphEditorVisibilityColor": [0.62745, 0.66667, 0.62745],
        "modernLockedCurveColor": [0.54902, 0.54902, 0.54902],
        "modernGraphEditorRotateYColor": [0.29020, 0.78431, 0.30980],
        "modernGraphEditorGrid": [0.31373, 0.31373, 0.31373],
        "modernGraphEditorScaleZColor": [0.07843, 0.73333, 0.87059],
        "modernGraphEditorRotateXColor": [1.00000, 0.24314, 0.23137],
        "modernGraphEditorTimeMarkerColor": [1.00000, 1.00000, 0.58824],
        "modernGraphEditorTimeRulerTickColor": [0.33725, 0.33725, 0.33725],
        "modernSliderOutPlayRangeOPACITY": [0.2, 0.2, 0.2],
        "modernGraphEditorBufferCurveColor": [0.22353, 0.22353, 0.22353],
        "modernGraphEditorTranslateYColor": [0.29020, 0.78431, 0.30980],
        "modernGraphEditorBreakDownKeyColor": [0.00000, 1.00000, 0.00000],
        "modernSecondarySelectionColor": [0.14510, 0.14510, 0.14510],
        "modernPreSelectHighlight": [1.00000, 1.00000, 1.00000],
        "modernGraphEditorKeyOnBufferCurveColor": [0.22353, 0.22353, 0.22353],
        "modernGraphEditorRegionSelectBackground": [0.33333, 0.33333, 0.33333],
        "modernPrimarySelectionColor": [1.00000, 1.00000, 1.00000],
        "modernOutPlayRangeColor": [0.25098, 0.25098, 0.25098],
        "modernGraphEditorRotateZColor": [0.07843, 0.73333, 0.87059],
        "modernGraphEditorDefaultKeyColor": [1.00000, 0.66667, 0.00000],
        "modernGraphEditorTimeRulerLabelColor": [0.89412, 0.89412, 0.89412],
        "modernGraphEditorTranslateXColor": [1.00000, 0.24314, 0.23137],
        "modernGraphEditorBackground": [0.39216, 0.39216, 0.39216],
        "modernLockedKeyColor": [0.17647, 0.17647, 0.17647],
        "modernGraphEditorGridAxis": [0.26667, 0.26667, 0.26667],
        "modernGraphEditorTimeRulerBackgroundColor": [0.41569, 0.41569, 0.41569],
        "modernValueLabel": [0.88235, 0.88235, 0.88235],
        "modernGraphEditorScaleXColor": [1.00000, 0.24314, 0.23137],
    }

def _get_classic_theme_colors():
    return {
        "modernGraphEditorTranslateZColor": [0.29020, 0.57255, 1.00000],
        "modernGraphEditorScaleYColor": [0.00000, 0.89804, 0.00000],
        "modernGraphEditorVisibilityColor": [0.69804, 0.74902, 0.69804],
        "modernLockedCurveColor": [0.50196, 0.50196, 0.50196],
        "modernGraphEditorRotateYColor": [0.00000, 0.89804, 0.00000],
        "modernGraphEditorGrid": [0.32549, 0.32549, 0.32549],
        "modernGraphEditorScaleZColor": [0.29020, 0.57255, 1.00000],
        "modernGraphEditorRotateXColor": [0.89804, 0.00000, 0.00000],
        "modernGraphEditorTimeMarkerColor": [1.00000, 0.00000, 0.00000],
        "modernGraphEditorTimeRulerTickColor": [0.32549, 0.32549, 0.32549],
        "modernGraphEditorBufferCurveColor": [0.20784, 0.20784, 0.20784],
        "modernGraphEditorTranslateYColor": [0.00000, 0.89804, 0.00000],
        "modernGraphEditorBreakDownKeyColor": [0.00000, 1.00000, 0.00000],
        "modernSecondarySelectionColor": [1.00000, 0.00000, 1.00000],
        "modernPreSelectHighlight": [1.00000, 0.80000, 0.90000],
        "modernGraphEditorKeyOnBufferCurveColor": [0.20784, 0.20784, 0.20784],
        "modernGraphEditorRegionSelectBackground": [0.50196, 0.50196, 0.50196],
        "modernPrimarySelectionColor": [1.00000, 1.00000, 0.00000],
        "modernOutPlayRangeColor": [0.08627, 0.08627, 0.08627],
        "modernSliderOutPlayRangeOPACITY": [0.2, 0.2, 0.2],
        "modernGraphEditorRotateZColor": [0.29020, 0.57255, 1.00000],
        "modernGraphEditorDefaultKeyColor": [0.00000, 0.00000, 0.00000],
        "modernGraphEditorTimeRulerLabelColor": [0.00000, 0.00000, 0.00000],
        "modernGraphEditorTranslateXColor": [0.89804, 0.00000, 0.00000],
        "modernGraphEditorBackground": [0.37500, 0.37500, 0.37500],
        "modernLockedKeyColor": [0.00000, 0.00000, 0.00000],
        "modernGraphEditorGridAxis": [0.47843, 0.47843, 0.47843],
        "modernGraphEditorTimeRulerBackgroundColor": [0.37647, 0.37647, 0.37647],
        "modernValueLabel": [0.00000, 0.00000, 0.00000],
        "modernGraphEditorScaleXColor": [0.89804, 0.00000, 0.00000],
    }

SIMPLE_KEY_VIEW_OPT = "graphEditorSimpleKeyView"
TIME_LINE_POS_OPT = "graphEdTimelinePos"
SHOW_PLAY_RANGE_SHADES_OPT = "graphEditorShowPlayRangeShades"
HIGHLIGH_AFFECTED_CURVES = "graphEditorHighlightAffectedCurves"

OPTION_INFO = {
    SIMPLE_KEY_VIEW_OPT: ("simpleKeyView", OPTION_VAR_TYPE_INT),
    TIME_LINE_POS_OPT: ("timelinePositionTop", OPTION_VAR_TYPE_STRING),
    SHOW_PLAY_RANGE_SHADES_OPT: ("showPlayRangeShades", OPTION_VAR_TYPE_INT),
    HIGHLIGH_AFFECTED_CURVES: ("hac", OPTION_VAR_TYPE_INT),
}

DARK_THEME_OPTIONS = {
    SIMPLE_KEY_VIEW_OPT: (False, 0),
    TIME_LINE_POS_OPT: (1, "Top"),
    SHOW_PLAY_RANGE_SHADES_OPT: (1, 1),
    HIGHLIGH_AFFECTED_CURVES: (True, 1),
}

CLASSIC_THEME_OPTIONS = {
    SIMPLE_KEY_VIEW_OPT: (True, 1),
    TIME_LINE_POS_OPT: (0, "Bottom"),
    SHOW_PLAY_RANGE_SHADES_OPT: (0, 0),
    HIGHLIGH_AFFECTED_CURVES: (True, 1),
}


def __get_colors_for_theme(theme_name):
    COLORS_FOR_THEMES = {
        DARK_THEME_NAME: _get_dark_theme_colors(),
        CLASSIC_THEME_NAME: _get_classic_theme_colors(),
        LIGHT_THEME_NAME: _get_light_theme_colors(),
        COLORBLIND_THEME_NAME: _get_colorblind_theme_colors(),
        TRS_DISTINCT_THEME_NAME: _get_trs_distinct_theme_colors(),
    }

    return COLORS_FOR_THEMES.get(theme_name, {})


def __get_options_for_theme(theme_name):
    if theme_name in (DARK_THEME_NAME, LIGHT_THEME_NAME, COLORBLIND_THEME_NAME, TRS_DISTINCT_THEME_NAME):
        return DARK_THEME_OPTIONS
    elif theme_name == CLASSIC_THEME_NAME:
        return CLASSIC_THEME_OPTIONS
    else:
        print ("No options for {} theme".format(theme_name))
        return {}


def __get_rounded_colors(rgb):
    return (round(rgb[0], 4), round(rgb[1], 4), round(rgb[2], 4))


def __is_color_ok(rgb):
    is_color_ok = all([0 <= color <= 1 for color in rgb ])
    return is_color_ok


def apply_theme(graph_editor, theme_name):
    theme_colors = __get_colors_for_theme(theme_name)
    theme_options = __get_options_for_theme(theme_name)

    apply_theme_options(graph_editor, theme_options)
    apply_theme_colors(theme_colors)


def apply_theme_options(graph_editor, theme_options):
    cmd_params = {"edit": True}
    for opt_name, (cmd_value, opt_value) in list(theme_options.items()):
        cmd_name, opt_type = OPTION_INFO[opt_name]
        cmd_params[cmd_name] = cmd_value
        option_var_set_value(opt_name, opt_type, opt_value)
    cmds.animCurveEditor(graph_editor, **cmd_params)


def apply_theme_colors(theme_colors):
    for color_name, rgb in list(theme_colors.items()):
        rgb = __get_rounded_colors(rgb)
        if __is_color_ok(rgb):
            cmds.displayRGBColor(color_name, rgb[0], rgb[1], rgb[2])
        else:
            cmds.warning( "Color value {} was incorrect for {}. Each value of color should be in range [0,1].".format(rgb, color_name))


def __get_all_ge_settings():
    return set(list(_get_dark_theme_colors().keys()) + list(_get_classic_theme_colors().keys()))


def export_current_ge_colors_in_clipboard():
    inViewMessage = maya.stringTable['y_maya_ge_applyThemes.kApplyThemesViewMessage' ]
    cmds.inViewMessage(smg=inViewMessage, fade=True, pos="topCenter")
    informationMessage = maya.stringTable['y_maya_ge_applyThemes.kApplyThemesInfoMsg' ]
    print (informationMessage)

    current_colors = {color: __get_rounded_colors(cmds.displayRGBColor( color, query=True )) for color in __get_all_ge_settings()}
    result_str = EXPORT_SCRIPT_TEMPLATE.format(current_colors=current_colors)
    setClipboardData(result_str)
    print (result_str)
    endOfExportColorsMessage = maya.stringTable['y_maya_ge_applyThemes.kApplyThemesEndOfExportColors' ]
    from sys import stdout as sys_stdout
    sys_stdout.write(endOfExportColorsMessage)
# ===========================================================================
# Copyright 2022 Autodesk, Inc. All rights reserved.
#
# Use of this software is subject to the terms of the Autodesk license
# agreement provided at the time of installation or download, or which
# otherwise accompanies this software in either electronic or hard copy form.
# ===========================================================================
