<!--
Copyright 2016 Autodesk, Inc. All rights reserved. 

Use of this software is subject to the terms of the Autodesk 
license agreement provided at the time of installation or download, 
or which otherwise accompanies this software in either electronic 
or hard copy form.
-->
<fragment  uiName="maya_CocDepthPass" name="maya_CocDepthPass" type="sceneEffect" class="ScriptFragment" version="1.0" feature_level="30" >
    <description>
    <![CDATA[
        DOF Circle of Confusion & depth pass: no-abs COC in .x, linear depth in .y
    ]]>
    </description>
    <properties>
        <countedObject  name="postEffectList" />
        <countedObject  name="nonPostEffectList" />
        <countedObject  name="advancedEffectList" />
        <camera  name="camera" />
        <target  name="finalDesc" />
        <float  name="alpha" />
        <float  name="focusDistance" />
        <float4  name="viewport" />
    </properties>
    <values>
        <float name="alpha" value="0.607640"  />
        <float name="focusDistance" value="5.000000"  />
        <float4 name="viewport" value="0.000000,0.000000,1.000000,1.000000"  />
    </values>
    <outputs>
        <target  name="output" />
    </outputs>
    <parametershare>
    </parametershare>
    <implementation render="OGS" language="ScriptInterpreter" version="0.1" >
        <scriptCommands>
            <AcquireTarget name="localBuffer" format="EFORMAT_R32G32B32_FLOAT" size="@finalDesc.size" relSize="1.0,1.0" msaa="0" />
            <AcquireTarget name="localDepth" format="EFORMAT_D24S8" size="@finalDesc.size" relSize="1.0,1.0" msaa="0" />
            <SetCamera value="@camera" />
            <Declare name="localState" type="stateSetter" />
            <SetStateCommand commandName="SetStateParameter" name="localState" parameter="SetBlendEnable" value="false" index="0" />
            <SetStateCommand commandName="CommitNewState" name="localState" />
            <SetViewport value="@viewport" />
            <SetTarget index="0" value="localBuffer" />
            <SetDepthStencil value="localDepth" />
            <Clear color="0.0,1000000.0,0.0,0.0" depth="1.0" stencil="0" />

            <Call name="SetPassSemantic" arg0="dofPass" arg1="TRUE" />

            <SetFragmentEffect name="depthCocEffect" path="maya_CocDepthSurface" />
            <SetEffectParameter effect="depthCocEffect" name="focusDistance" value="@focusDistance" />
            <SetEffectParameter effect="depthCocEffect" name="alpha" value="@alpha" />
            <SetEffectParameter effect="depthCocEffect" name="excludedFromPostEffects" value="0.0" />
            <Render name="@postEffectList" />
            <SetEffectParameter effect="depthCocEffect" name="excludedFromPostEffects" value="1.0" />
            <Render name="@nonPostEffectList" />
            <RestoreOverrideEffect />

            <Call name="mayaCOCDepthCB" arg0="begin" />
            <Render name="@advancedEffectList" />
            <Call name="mayaCOCDepthCB" arg0="end" />

            <Call name="SetPassSemantic" arg0="dofPass" arg1="FALSE" />

            <SetParameter name="@output" value="localBuffer" />
            <SetStateCommand commandName="RestorePreviousState" name="localState" />
        </scriptCommands>
    </implementation>
</fragment>

